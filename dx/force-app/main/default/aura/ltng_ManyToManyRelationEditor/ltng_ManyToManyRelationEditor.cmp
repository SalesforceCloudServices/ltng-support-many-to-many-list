<!--
/**
* Form to create child records.
* @component: ltng_CacheDemoChildForm
**/
-->
<aura:component
    controller="ltng_ManyToManyCtrl"
    implements="force:appHostable,flexipage:availableForAllPageTypes,flexipage:availableForRecordHome,force:hasRecordId,force:lightningQuickAction,lightning:actionOverride"
    access="global"
>
    <!-- attributes -->
    <aura:attribute name="recordId" type="String" />

    <!-- data - @TODO: review lightning:RecordForm -->
    <force:recordData aura:id="forceRecord"
        recordId="{!v.recordId}"
        layoutType="FULL"
        targetFields="{!v.currentRelationship}"
        fields="Id,Name,LeftObjectAPIName__c,JunctionLeftObjectRelationshipField__c,JunctionObjectAPIName__c,JunctionRightObjectRelationshipField__c,RightObjectAPIName__c"
        mode="EDIT"
        recordUpdated="{!c.recordUpdated}"
    />

    <!-- private attributes -->
    <aura:attribute name="currentRelationship" type="ltng_M2M_Relationship__c" access="private" />
    <aura:attribute name="sobjectList" type="Object[]" access="private" />
    <aura:attribute name="junctionList" type="Object[]" access="private" />
    <aura:attribute name="leftObjectApiName" type="String" access="private" />
    <aura:attribute name="rightObjectApiName" type="String" access="private" />
    <aura:attribute name="junctionObjectApiName" type="String" access="private" />
    <!-- handlers -->
    <aura:handler name="init" value="{!this}" action="{!c.init}" />
    <!-- events -->
    <!-- elements -->

    <!-- PAGE HEADER -->
    <lightning:layout class="slds-page-header slds-page-header--object-home">
        <lightning:layoutItem>
            <lightning:icon iconName="standard:forecasts" alternativeText="M2M Relation"/>
        </lightning:layoutItem>
        <lightning:layoutItem padding="horizontal-small">
            <div class="page-section page-header">
                <h1 class="slds-text-heading--label">M2M Relation</h1>
                <h2 class="slds-text-heading--medium">{! if(v.recordId, 'Edit Record', 'Create Record') }</h2>
            </div>
        </lightning:layoutItem>
    </lightning:layout>

    <!--form -->
    <div class="slds-box slds-theme_default">
        <lightning:layout>
            <lightning:layoutItem padding="around-small" size="6">
                <div aria-labelledby="m2m-relation-form">
                    <form class="slds-form--stacked">
                        <lightning:select aura:id="leftObjectSelector" name="leftObjectSelector" label="Which object starts the Many to Many relationship?"
                            required="true"
                            onchange="{!c.handleLeftSelected}"
                        >
                            <aura:iteration items="{!v.sobjectList}" var="sobject">
                                <!-- sobject.QualifiedApiName == v.currentRelationship.LeftObjectAPIName__c -->
                                <option text="{!sobject.sObjectLabel}" value="{!sobject.sObjectApiName}"
                                    selected="{!sobject.sObjectApiName == 'ltng_M2M_Account__c'}"
                                ></option>
                            </aura:iteration>
                        </lightning:select>
                        <lightning:select aura:id="junctionSelector" name="junctionSelector" label="Which of the following is the junction object?"
                            required="true"
                            onchange="{!c.handleJunctionSelected}"
                        >
                            <aura:iteration items="{!v.junctionList}" var="sobject">
                                <!-- sobject.QualifiedApiName == v.currentRelationship.LeftObjectAPIName__c -->
                                <option text="{!sobject.sObjectLabel}" value="{!sobject.sObjectApiName}"
                                ></option>
                            </aura:iteration>
                        </lightning:select>
                        <lightning:select aura:id="rightObjectSelector" name="rightObjectSelector" label="Which object ends the Many to Many relationship?"
                            required="true"
                            onchange="{!c.handleRightSelected}"
                        >
                            <aura:iteration items="{!v.sobjectList}" var="sobject">
                                <!-- sobject.QualifiedApiName == v.currentRelationship.RightObjecsfdtAPIName__c -->
                                <option text="{!sobject.sObjectLabel}" value="{!sobject.sObjectApiName}"
                                    selected="{!sobject.sObjectApiName == 'ltng_M2M_Contact__c'}"
                                ></option>
                            </aura:iteration>
                        </lightning:select>
                    </form>
                </div>
            </lightning:layoutItem>
        </lightning:layout>   
    </div>

    <!-- footer -->
    <div style="height: 180px;">
        <div class="slds-docked-form-footer">
            <lightning:button label="Cancel" title="Cancel" variant="neutral" />
            <lightning:button label="Save" title="Save" variant="brand" />
        </div>
    </div>
    <!--
    <div class="slds-page-header">
        <div class="slds-media">
            <div class="slds-media__figure">
                <span class="slds-icon_container slds-icon-standard-opportunity" title="Description of icon when needed">
                    <lightning:icon iconName="standard:forecasts" alternativeText="M2M Relation" />
                </span>
            </div>
            <div class="slds-media__body">
                <h1 class="slds-page-header__title slds-truncate slds-align-middle" title="M2M Relation">M2M Relation</h1>
            </div>
        </div>
    </div>

    <div class="slds-box slds-theme_default slds-m-top_medium">
        <aura:if isTrue="{!v.currentRelationship}">
        <ul>
            <li>record</li>
            <li>LeftObjectAPIName__c : {!v.currentRelationship.LeftObjectAPIName__c}</li>
            <li>JunctionObjectAPIName__c : {!v.currentRelationship.JunctionObjectAPIName__c}</li>
            <li>RightObjectAPIName__c : {!v.currentRelationship.RightObjectAPIName__c}</li>
        </ul>
        </aura:if>
    </div>

    <div style="height: 180px;">
        <div class="slds-docked-form-footer">
            <lightning:button label="Cancel" title="Cancel" variant="neutral" />
            <lightning:button label="Save" title="Save" variant="brand" />
        </div>
    </div>
    -->
</aura:component>
